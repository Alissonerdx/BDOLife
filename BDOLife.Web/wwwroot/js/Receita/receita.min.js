function SubtrairQuantidade(n,t){let i=BuscarIngredientePorId(n);if(i!==null&&i!==undefined){let r=Inputmask.unmask(`${i.quantidadeTotal}`,{alias:"prata"}),n=parseInt(r)-parseInt(t);n===0?$("#ingredientesGrid").jsGrid("deleteItem",i):(i.quantidadeTotal=n,$("#ingredientesGrid").jsGrid("updateItem",i))}}function AtualizarTotais(){let n=$("#resultadosGrid").jsGrid("option","data"),t=$("#ingredientesGrid").jsGrid("option","data");CalcularTotais(t,n)}function CalcularTotais(n,t){let i=0,r=0;if(n!==undefined&&n.length>0){for(let t=0;t<n.length;t++)if(n[t].ignorar===!1){let r=parseInt(Inputmask.unmask(`${n[t].quantidadeTotal}`,{alias:"prata"})),u=parseInt(Inputmask.unmask(`${n[t].precoMarket}`,{alias:"prata"})),f=r*u;i+=f}$("#custoTotal").html(Inputmask.format(`${i}`,{alias:"prata"}))}else $("#custoTotal").html(Inputmask.format("0",{alias:"prata"}));if(t!==undefined&&t.length>0){for(let n=0;n<t.length;n++)if(t[n].ignorar===!1){let i=parseInt(Inputmask.unmask(`${t[n].quantidade}`,{alias:"prata"})),u=parseInt(Inputmask.unmask(`${t[n].preco}`,{alias:"prata"}));r+=i*u}$("#lucroBruto").html(Inputmask.format(`${r}`,{alias:"prata"}))}else $("#lucroBruto").html(Inputmask.format("0",{alias:"prata"}));let u=parseInt(r*.845-i),f=parseInt(r*.65-i);u<0?($("#lucroComPctEconomico").removeClass("valor-positivo"),$("#lucroComPctEconomico").addClass("valor-negativo"),$("#lucroComPctEconomico").html("-"+Inputmask.format(`${u}`,{alias:"prata"}))):($("#lucroComPctEconomico").removeClass("valor-negativo"),$("#lucroComPctEconomico").addClass("valor-positivo"),$("#lucroComPctEconomico").html(Inputmask.format(`${u}`,{alias:"prata"})));f<0?($("#lucroSemPctEconomico").removeClass("valor-positivo"),$("#lucroSemPctEconomico").addClass("valor-negativo"),$("#lucroSemPctEconomico").html("-"+Inputmask.format(`${f}`,{alias:"prata"}))):($("#lucroSemPctEconomico").removeClass("valor-negativo"),$("#lucroSemPctEconomico").addClass("valor-positivo"),$("#lucroSemPctEconomico").html(Inputmask.format(`${f}`,{alias:"prata"})))}function ConfigurarMaestriaImperial(){$("#configuracaoMaestria").iziModal("open")}function ConfigurarQuantidades(){$("#configuracaoQuantidade").iziModal("open")}function SalvarMaestriaImperial(){maestriaImperialSelecionada=parseInt($("#maestriaImperialSelect").val());$("#configuracaoMaestria").iziModal("close")}function SalvarQtdReceita(){$("#quantidade").val($("#quantidadeReceitasCalculadora").val());$("#configuracaoQuantidade").iziModal("close")}function BuscarIngredientePorId(n){var t=$("#ingredientesGrid").jsGrid("option","data");return t.filter(t=>t.id===n)[0]}function AdicionarQuantidade(n){let r="",i=[],t=n;n.original!==null&&n.original!==undefined?(i=n.original.id.split("-"),r=i[i.length-1],t=n.original):(i=n.id.split("-"),r=i[i.length-1]);let u=BuscarIngredientePorId(r);if(u===null||u===undefined){let n=t.produzirOuComprar==="PRODUZIR"?t.custoProducao:t.valor,i=Inputmask.format(`${parseInt(t.quantidade)*parseInt(n)}`,{alias:"prata"});$("#ingredientesGrid").jsGrid("insertItem",{id:r,img:t.icon,item:t.nomeItem,quantidadeTotal:t.quantidade,precoMarket:t.valor,precoTotal:i,dataAtualizacao:t.dataAtualizacao,quantidadeDisponivel:t.quantidadeDisponivel,vendeNPC:t.vendeNPC,localNPC:t.localNPC,valorNPC:t.valorNPC,ignorar:!1,custoProducao:t.custoProducao,custoCompra:t.custoCompra,produzirOuComprar:t.produzirOuComprar})}else u.quantidadeTotal+=parseInt(t.quantidade),$("#ingredientesGrid").jsGrid("updateItem",u)}function AlterarConfiguracao(){if(ingredienteNodeSelecionado!==null){console.log(ingredienteNodeSelecionado);let n=$("#configurarIngrediente").find("#procNormalConfIngrediente").val(),t=$("#configurarIngrediente").find("#procRaroConfIngrediente").val(),i=$("#configurarIngrediente").find("#usarProcRaroConfIngrediente").is(":checked");if(n!==""&&t!==""&&quantidade!==""&&precoUnitario!==""&&quantidade!==0&&precoUnitario!==0){let n=ingredienteNodeSelecionado.parent,o=$("#treeViewContent").jstree("get_node",n),f=parseInt(ingredienteNodeSelecionado.original.quantidade),e=parseInt(ingredienteNodeSelecionado.original.quantidadePorReceita),t=ingredienteNodeSelecionado.id.split("-"),r=t[t.length-1],u=BuscarIngredientePorId(r);u!==undefined&&u!==null&&SubtrairTrocaItem(ingredienteNodeSelecionado.original.id);ConfigurarIngredienteTreeView(n,r,$("#configurarIngrediente").find("#procNormalConfIngrediente").val(),$("#configurarIngrediente").find("#procRaroConfIngrediente").val(),f,e,i).then(function(n){console.log(n);let t=$("#treeViewContent").jstree("get_children_dom",ingredienteNodeSelecionado.original);t.each(function(n,t){SubtrairTrocaItem(t)});$("#treeViewContent").jstree("delete_node",`#${ingredienteNodeSelecionado.id}`);n.forEach(function(n,t){t===0&&(n.valor=parseInt(Inputmask.unmask(`${ingredienteNodeSelecionado.original.valor}`,{alias:"prata"})));$("#treeViewContent").jstree("create_node",n.parent==="#"?"raiz":n.parent,n,"inside");n.parent===ingredienteNodeSelecionado.id&&AdicionarQuantidade(n)})});$("#configurarIngrediente").iziModal("close")}}}function AlterarIngrediente(){if(ingredienteNodeSelecionado!==null){let t=$("#trocarIngrediente").find("#ingredienteAlternativo").select2("data")[0],n=$("#trocarIngrediente").find("#quantidadeIngrediente").val(),i=$("#trocarIngrediente").find("#precoUnitario").val();if(n!==""&&i!==""&&n!==0&&i!==0){let f=ingredienteNodeSelecionado.parent,e=$("#treeViewContent").jstree("get_node",f),o=e.original.quantidade,r=ingredienteNodeSelecionado.original.id.split("-"),s=r[r.length-1],u=BuscarIngredientePorId(s);u!==undefined&&u!==null&&SubtrairTrocaItem(ingredienteNodeSelecionado.original.id);let h=parseInt(o)*parseInt(n);BuscarTreeView(ingredienteNodeSelecionado.parent,t.id,$("#proc-normal").val(),$("#proc-raro").val(),h,parseInt(n)).then(function(n){let r=$("#treeViewContent").jstree("get_children_dom",ingredienteNodeSelecionado.original);r.each(function(n,t){SubtrairTrocaItem(t)});$("#treeViewContent").jstree("delete_node",`#${ingredienteNodeSelecionado.id}`);n.forEach(function(n,r){r===0&&(n.valor=parseInt(Inputmask.unmask(`${i}`,{alias:"prata"})));$("#treeViewContent").jstree("create_node",n.parent==="#"?"raiz":n.parent,n,"inside");(t.tipo===1||t.tipo===2||n.nivelSubReceita===1)&&AdicionarQuantidade(n)})});$("#trocarIngrediente").iziModal("close")}}}function BuscarTreeView(n,t,i,r,u,f){return BlockElement("#treeView"),$.ajax({type:"POST",url:"/Receita/TreeViewSubReceita",data:{raiz:n,receitaReferenciaId:t,quantidadePorReceita:f,quantidade:u,procNormal:i,procRaro:r},success:function(){UnblockElement("#treeView")}})}function ConfigurarIngredienteTreeView(n,t,i,r,u,f,e){return BlockElement("#treeView"),$.ajax({type:"POST",url:"/Receita/TreeViewSubReceita",data:{raiz:n,receitaReferenciaId:t,quantidadePorReceita:f,quantidade:u,procNormal:i,procRaro:r,usarProcRaro:e},success:function(){UnblockElement("#treeView")}})}function SubtrairTrocaItem(n){let i=$("#treeViewContent").jstree("get_node",n),r=i.original.id.split("-"),u=r[r.length-1],f=$("#treeViewContent").jstree("get_children_dom",i),t=[];for(f.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))});t.length>0;){let n=t.pop();if($("#treeViewContent").jstree("is_leaf",n)){let t=n.original.id.split("-"),i=t[t.length-1];SubtrairQuantidade(i,n.original.quantidade)}else{$("#treeViewContent").jstree("open_all",n);let i=$("#treeViewContent").jstree("get_children_dom",n);i.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))})}}let e=BuscarIngredientePorId(u);SubtrairQuantidade(u,i.original.quantidade)}var maestriaImperialSelecionada=0,ingredienteNodeSelecionado=null,pagina=window.location.pathname,placeholderMaestria="",tipoReceita=0;$(document).ready(function(){function n(){pagina.toLowerCase().includes("culinaria")?(placeholdeMaestria="Selecione a maestria (Culinária)",tipoReceita=2):pagina.toLowerCase().includes("alquimia")&&(placeholdeMaestria="Selecione a maestria (Alquimia)",tipoReceita=1)}function t(){$(".custo-producao-tooltip").popover({title:"Custo de Produção",content:`Calculado com base no valor de compra dos ingredientes da receita (Materiais, SubReceitas), quando a receita possui proc raro o mesmo é considerado no cálculo, Ex: proc normal: 2.5, proc raro: 0.3, proc considerado = 2.8 (2.5 + 0.3).`,trigger:"hover",placement:"right"}).popover("show")}function i(){$("#configurarIngrediente").iziModal({title:"Configurar",background:"#494C56",headerColor:"#33363F",width:"60%",radius:20,top:200,closeOnEscape:!1,overlayClose:!1,onOpening:function(){let n=$("#treeViewContent").jstree("get_selected")[0];ingredienteNodeSelecionado=$("#treeViewContent").jstree("get_node",n)},afterRender:function(){$("#configurarIngrediente").find("#procNormalConfIngrediente").inputmask({mask:"9[,99]",radixPoint:",",greedy:!1,clearIncomplete:!0,showMaskOnHover:!1,showMaskOnFocus:!1,clearMaskOnLostFocus:!0,autoclear:!1,definitions:{"*":{validator:"[0-9]"}},rightAlign:!0});$("#configurarIngrediente").find("#procRaroConfIngrediente").inputmask({mask:"9[,99]",radixPoint:",",greedy:!1,clearIncomplete:!0,showMaskOnHover:!1,showMaskOnFocus:!1,clearMaskOnLostFocus:!0,autoclear:!1,definitions:{"*":{validator:"[0-9]"}},rightAlign:!0});$("#configurarIngrediente").find("#maestriaConfIngrediente").select2({placeholder:"Selecione a maestria",language:"pt-BR",width:"100%",dropdownCssClass:"increasedzindexclass",templateResult:formatState,templateSelection:formatState,allowClear:!0,ajax:{url:"/Maestria/SelectMaestrias",type:"GET",data:function(n){return{search:parseInt(n.term),tipo:tipoReceita}},processResults:function(n){return n}}});$("#configurarIngrediente").find("#maestriaConfIngrediente").on("change",function(){let n=$(this).select2("data")[0];n!==undefined&&($("#configurarIngrediente").find("#procNormalConfIngrediente").inputmask("setvalue",n.procNormal),$("#configurarIngrediente").find("#procRaroConfIngrediente").inputmask("setvalue",n.procRaro),$("#configurarIngrediente").find("#procNormalConfIngrediente").focus(),$("#configurarIngrediente").find("#procRaroConfIngrediente").focus())})}});$("#trocarIngrediente").iziModal({title:"Alterar ingrediente",background:"#494C56",headerColor:"#33363F",width:"60%",radius:20,top:200,closeOnEscape:!1,overlayClose:!1,onOpening:function(){let u=$("#treeViewContent").jstree("get_selected")[0],t=$("#treeViewContent").jstree("get_node",u),i=t.parent.split("-"),r=i[i.length-1],n=$("#treeViewContent").jstree("get_node",t.parent);while((r.includes("PCH")||r.includes("PDE")||r.includes("RFI")||r.includes("PMO"))&&n.original.grupo!==null&&n.original.grupo!==undefined&&n.original.grupo!=="")t=n,i=n.parent.split("-"),r=i[i.length-1],n=$("#treeViewContent").jstree("get_node",n.parent);ingredienteNodeSelecionado=t;$("#trocarIngrediente").find("#grupoItemTrocaSelecionado").val(t.original.grupo)},afterRender:function(){$("#quantidadeIngrediente").inputmask({alias:"integer",allowMinus:!1,mask:"9999999"});$("#precoUnitario").inputmask({alias:"prata"});$("#trocarIngrediente").find("#ingredienteAlternativo").data("select2")&&$("#trocarIngrediente").find("#ingredienteAlternativo").val("").trigger("change");$("#ingredienteAlternativo").select2({placeholder:"Selecione o ingrediente",language:"pt-BR",width:"100%",dropdownCssClass:"increasedzindexclass",templateResult:formatState,templateSelection:formatState,ajax:{url:"/Item/SelectItensPorGrupo",type:"GET",data:function(n){return{search:n.term,page:n.page||1,grupo:$("#trocarIngrediente").find("#grupoItemTrocaSelecionado").val()}},processResults:function(n){return{results:n}}}});$("#ingredienteAlternativo").on("select2:select",function(){let n=$(this).select2("data")[0],t=n.valor;$("#precoUnitario").val(t)})}});$("#configuracaoMaestria").iziModal({title:"Configuração da Maestria",background:"#494C56",headerColor:"#33363F",radius:20,top:200,afterRender:function(){$("#maestriaImperialSelect").select2({placeholder:"Selecione a maestria (Entrega Imperial)",language:"pt-BR",width:"100%",dropdownCssClass:"increasedzindexclass",templateResult:formatState,templateSelection:formatState,allowClear:!0,ajax:{url:"/Maestria/SelectMaestrias",type:"GET",data:function(n){return{search:parseInt(n.term),tipo:tipoReceita}},processResults:function(n){return n}}})}});$("#configuracaoQuantidade").iziModal({title:"Calculadora de Quantidade",background:"#494C56",headerColor:"#33363F",radius:20,width:"60%",top:200,afterRender:function(){$("#configuracaoQuantidade").find("#quantidadeProdutosCalculadora").inputmask({alias:"integer",allowMinus:!1,mask:"9999999"});$("#configuracaoQuantidade").find("#quantidadeDiasCalculadora").inputmask({alias:"integer",allowMinus:!1,mask:"9999999"});$("#configuracaoQuantidade").find("#procNormalCalculadora").inputmask({mask:"9[,99]",radixPoint:",",greedy:!1,clearIncomplete:!0,showMaskOnHover:!1,showMaskOnFocus:!1,clearMaskOnLostFocus:!0,autoclear:!1,definitions:{"*":{validator:"[0-9]"}},rightAlign:!0});$("#configuracaoQuantidade").find("#quantidadeProdutosCalculadora").val(0);$("#configuracaoQuantidade").find("#quantidadeDiasCalculadora").val(1);$("#configuracaoQuantidade").find("#procNormalCalculadora").val("2.50");$("#configuracaoQuantidade").find("#totalProdutosCalculadora").val(0);$("#configuracaoQuantidade").find("#quantidadeReceitasCalculadora").val(0);$("#quantidadeProdutosCalculadora, #quantidadeDiasCalculadora, #procNormalCalculadora").on("keyup",function(){let n=$("#quantidadeProdutosCalculadora").val();(n===""||n===undefined)&&(n=0);let t=$("#quantidadeDiasCalculadora").val();(t===""||t===undefined)&&(t=0);let i=parseFloat($("#procNormalCalculadora").val().replace(/,/g,"."));(i===""||i===undefined)&&(i=0);let r=n*t;$("#totalProdutosCalculadora").val(r);$("#quantidadeReceitasCalculadora").val(Math.ceil(r/i))})}})}function r(){setInterval(AtualizarTotais,1e3)}function u(){$("#maestriaSelect").on("change",function(){let n=$(this).select2("data")[0];n!==undefined&&($("#proc-normal").inputmask("setvalue",$(n.element).attr("data-proc-normal")),$("#proc-raro").inputmask("setvalue",$(n.element).attr("data-proc-raro")),$("#proc-normal").focus(),$("#proc-raro").focus())});$("#consultarForm").on("submit",function(n){n.preventDefault();$("#ingredientesGrid").jsGrid("loadData");$("#resultadosGrid").jsGrid("loadData");$("#dependenciaDiretaTb").jsGrid("loadData");$("#dependenciaIndiretaTb").jsGrid("loadData");$("#resultadosImperialGrid").jsGrid("loadData");$("#treeViewContent").jstree(!0).refresh();CarregarGraficos()})}function f(){$("#receitaSelect").select2({placeholder:"Selecione a receita",language:"pt-BR",width:"100%",allowClear:!0,cacheDataSource:[],escapeMarkup:function(n){return n}});$.get(`/Maestria/SelectMaestrias?tipo=${tipoReceita}`,function(n){$("#maestriaSelect").append("<option>Selecione a maestria<\/option>");n.results.forEach(function(n){$("#maestriaSelect").append(`<option data-proc-normal='${n.procNormal}' data-proc-raro='${n.procRaro}' data-regularmpc='${n.regularMaxProcChance}' data-rarempc='${n.rareMaxProcChance}' value='${n.id}'>${n.text}</option>`)});$("#maestriaSelect").select2({placeholder:placeholderMaestria,language:"pt-BR",width:"100%",templateResult:formatState,templateSelection:formatState,allowClear:!0})})}function e(){$("#treeview-search").keyup(function(){$("#treeViewContent").jstree("search",$(this).val())});$("#treeViewContent").jstree({core:{dblclick_toggle:!1,animation:0,check_callback:!0,themes:{responsive:!0},data:function(n,t){BlockElement("#treeView");$.ajax({type:"POST",url:"/Receita/TreeView",data:{receitaReferenciaId:$("#receitaSelect").val(),quantidade:parseInt($("#quantidade").inputmask("unmaskedvalue")),procNormal:$("#proc-normal").val(),procRaro:$("#proc-raro").val(),tipo:tipoReceita,maestriaId:$("#maestriaSelect").val()},success:function(n){console.log(n);t(n);UnblockElement("#treeView")}})}},types:{},plugins:["contextmenu","search","sort",],search:{case_insensitive:!0,show_only_matches:!0},contextmenu:{items:function(n){let u=n.original.grupo,t=null,i=null,e=n.children.length>0?!0:!1,o=n.original.possuiProcRaro;u!==null&&u!==""&&n.id!=="raiz"&&(t={separator_before:!1,separator_after:!1,label:"Substituir",action:function(){$("#trocarIngrediente").find("#ingredienteAlternativo").val(null).trigger("change");$("#trocarIngrediente").find("#precoUnitario").val("");$("#trocarIngrediente").find("#quantidadeIngrediente").val("");$("#trocarIngrediente").iziModal("open")}});let f=n.id.split("-"),r=f[f.length-1];return(r.includes("PCH")||r.includes("PDE")||r.includes("RFI")||r.includes("PMO")||!e||!o||n.id==="raiz"||(i={separator_before:!1,separator_after:!1,label:"Configurar",action:function(){$("#configurarIngrediente").find("#maestriaConfIngrediente").val(null).trigger("change");$("#configurarIngrediente").find("#procNormalConfIngrediente").val(`${n.original.procNormal}0`.replace(".",","));$("#configurarIngrediente").find("#procRaroConfIngrediente").val(`${n.original.procRaro}0`.replace(".",","));n.original.usarProcRaro===!0?$("#configurarIngrediente").find("#usarProcRaroConfIngrediente").iCheck("check"):$("#configurarIngrediente").find("#usarProcRaroConfIngrediente").iCheck("uncheck");$("#configurarIngrediente").iziModal("open")}}),t!==null&&i===null)?{TrocarIngrediente:t}:t===null&&i!==null?{Configurar:i}:t!==null&&i!==null?{TrocarIngrediente:t,Configurar:i}:null}}});$("#treeViewContent").on("open_node.jstree",function(n,t){let i=t.node.original,r=i.id.split("-"),u=r[r.length-1],f=$("#treeViewContent").jstree("get_children_dom",i);if($("#treeViewContent").jstree(!0).get_parent(t.node)!=="#"){let n=BuscarIngredientePorId(u),t=[];for(f.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))});t.length>0;){let n=t.pop();if($("#treeViewContent").jstree("is_leaf",n)||$("#treeViewContent").jstree("is_closed",n)){let t=n.original.id.split("-"),i=t[t.length-1];AdicionarQuantidade(n)}else{let i=$("#treeViewContent").jstree("get_children_dom",n);i.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))})}}if(n!==null&&n!==undefined){let r=Inputmask.unmask(`${n.quantidadeTotal}`,{alias:"prata"}),t=parseInt(r)-parseInt(i.quantidade);t===0?$("#ingredientesGrid").jsGrid("deleteItem",n):(n.quantidadeTotal=t,$("#ingredientesGrid").jsGrid("updateItem",n))}}});$("#treeViewContent").on("close_node.jstree",function(n,t){let i=t.node.original,r=i.id.split("-"),u=r[r.length-1],f=$("#treeViewContent").jstree("get_children_dom",i);if($("#treeViewContent").jstree(!0).get_parent(t.node)!=="#"){let n=[];for(f.each(function(t,i){n.push($("#treeViewContent").jstree("get_node",i))});n.length>0;){let t=n.pop();if($("#treeViewContent").jstree("is_leaf",t)||$("#treeViewContent").jstree("is_closed",t)){let n=t.original.id.split("-"),i=n[n.length-1];SubtrairQuantidade(i,t.original.quantidade)}else{let i=$("#treeViewContent").jstree("get_children_dom",t);i.each(function(t,i){n.push($("#treeViewContent").jstree("get_node",i))})}}let r=BuscarIngredientePorId(u);if(r===null||r===undefined){let n=i.produzirOuComprar==="PRODUZIR"?i.custoProducao:i.valor,r=Inputmask.format(`${parseInt(i.quantidade)*parseInt(n)}`,{alias:"prata"});var e=t.node;$("#ingredientesGrid").jsGrid("insertItem",{id:u,img:i.icon,item:i.nomeItem,quantidadeTotal:i.quantidade,precoMarket:i.valor,precoTotal:r,dataAtualizacao:i.dataAtualizacao,quantidadeDisponivel:i.quantidadeDisponivel,vendeNPC:i.vendeNPC,localNPC:i.localNPC,valorNPC:i.valorNPC,ignorar:!1,custoProducao:i.custoProducao,custoCompra:i.custoCompra,produzirOuComprar:i.produzirOuComprar})}else r.quantidadeTotal+=parseInt(i.quantidade),$("#ingredientesGrid").jsGrid("updateItem",r)}});$("#treeViewContent").on("expandir",function(n){n.preventDefault();let i=$("#treeViewContent").jstree("get_node","raiz_anchor"),r=$("#treeViewContent").jstree("get_children_dom",i),t=[];for(r.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))});t.length>0;){let n=t.pop();if($("#treeViewContent").jstree("is_leaf",n)===!1&&$("#treeViewContent").jstree("is_closed",n)){$("#treeViewContent").jstree("open_node",n);let i=$("#treeViewContent").jstree("get_children_dom",n);i.each(function(n,i){t.push($("#treeViewContent").jstree("get_node",i))})}}});$("#treeViewContent").on("agrupar",function(n){n.preventDefault();let i=$("#treeViewContent").jstree("get_node","raiz_anchor");if(i.state.opened!==!1){let n=i.children,r=n.every(function(n){let t=$("#treeViewContent").jstree("get_node",n);return t.state.opened===!1});if(!r){$("#ingredientesGrid").jsGrid("option","data",[]);for(var t=0;t<n.length;t++){let i=$("#treeViewContent").jstree("get_node",n[t]);i.state.opened=!0;$("#treeViewContent").jstree("close_node",i)}}}});$("#ingredientesGrid").off().on("keydown","input[type=text], input[type=number], select",n=>{n.which===13&&$("#ingredientesGrid").jsGrid("updateItem")});$("#resultadosGrid").off().on("keydown","input[type=text], input[type=number], select",n=>{n.which===13&&$("#resultadosGrid").jsGrid("updateItem")})}function o(){$("#ingredientesGrid").jsGrid({width:"100%",inserting:!1,editing:!0,sorting:!1,paging:!1,autoload:!1,selecting:!1,pageLoading:!1,confirmDeleting:!1,onItemUpdated:function(){$("#ingredientesGrid").jsGrid("refresh")},onRefreshed:function(n){var r=n.grid.option("data"),i={Id:"",Img:"",Item:"",QuantidadeTotal:0,PrecoMarket:0,PrecoTotal:0,IsTotal:!0},t;r.forEach(function(n){let t=0,r=0;t=typeof n.precoMarket=="string"?parseInt(Inputmask.unmask(n.precoMarket,{alias:"prata"})):n.precoMarket;n.produzirOuComprar==="PRODUZIR"&&(t=parseInt(Inputmask.unmask(`${n.custoProducao}`,{alias:"prata"})));r=typeof n.quantidadeTotal=="string"?parseInt(Inputmask.unmask(n.quantidadeTotal,{alias:"prata"})):n.quantidadeTotal;n.ignorar===!1&&(i.PrecoTotal+=r*t)});t=$("<tr>").addClass("total-row");n.grid._renderCells(t,i);n.grid._content.append(t);$(".receita-image").hover(function(){let i=$(this).attr("data-nome"),r=Inputmask.format(`${$(this).attr("data-valor")}`,{alias:"prata"}),u=$(this).attr("data-atualizacao"),f=Inputmask.format(`${$(this).attr("data-quantidadeDisponivel")}`,{alias:"prata"}),e=$(this).attr("data-npc"),o=$(this).attr("data-valor-npc"),n=$(this).attr("data-local-npc"),s=$(this).attr("data-disponivel"),t="";if(e==="true"&&o!==null&&(t='<p class="text-center">VENDIDO NO NPC:<\/p>',n!==null&&n!=="")){let i=n.split("|");i.forEach(function(n){t+=`${n}`})}$(this).popover({title:i,html:!0,content:`<p>Qtd. Disponível no Mercado: ${f}</p> <p>Valor Unitário: ${r}</p> <p>Atualizado em: ${u}</p>${t}`,trigger:"hover",placement:"right"}).popover("show")})},fields:[{name:"id",visible:!1},{name:"img",align:"center",title:"",width:80,itemTemplate:function(n,t){if(t.IsTotal)return"Totais";let i=Inputmask.format(`${t.precoMarket}`,{alias:"prata"});return t.img!==null&&t.img!==undefined&&t.img!==""?`<img class="receita-image" data-nome="${t.item}" data-quantidadeDisponivel="${t.quantidadeDisponivel}" data-disponivel="${t.disponivel?"DISPONIVEL":"INDISPONIVEL"}" data-atualizacao="${t.dataAtualizacao}" data-valor="${i}" src="${t.img}" data-npc="${t.vendeNPC}" data-valor-npc="${t.valorNPC}" data-local-npc="${t.localNPC}" style="max-width: 44px;"/>`:`<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsBAMAAADsqkcyAAAAFVBMVEXr6+sAAABYWFiSkpKwsLDNzc11dXVUvnWIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAOElEQVQokWNgGAUjAjABITINBcZAyMLgAKYRgCWYJRgkB6HhgNnN2Q2kFEIjiQMhyBAQPQoGPQAAoJ4FT0msjZwAAAAASUVORK5CYII=" style="max-width: 44px;"/>`}},{name:"item",title:"Ingrediente",type:"text",width:160,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":n}},{name:"quantidadeTotal",type:"prataField",title:"Quantidade Total",width:180,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})}},{name:"precoMarket",type:"prataField",title:"Custo de Compra/UN",width:180,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})}},{name:"custoProducao",type:"prataField",title:"Custo de Produção/UN",width:180,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})},headerTemplate:function(){return $(`<th class="custo-producao-tooltip">${this.title}</th>`)}},{name:"produzirOuComprar",title:"Produzir/Comprar",type:"select",width:150,align:"center",editing:!0,inserting:!1,items:[{text:"Comprar",value:"COMPRAR"},{text:"Produzir",value:"PRODUZIR"}],valueField:"value",textField:"text"},{name:"precoTotal",type:"prataField",title:"Custo Total",width:120,editing:!1,inserting:!1,itemTemplate:function(n,t){if(t.IsTotal)return Inputmask.format(`${t.PrecoTotal}`,{alias:"prata"});let i=parseInt(Inputmask.unmask(`${t.precoMarket}`,{alias:"prata"}));t.produzirOuComprar==="PRODUZIR"&&(i=parseInt(Inputmask.unmask(`${t.custoProducao}`,{alias:"prata"})));let r=parseInt(Inputmask.unmask(`${t.quantidadeTotal}`,{alias:"prata"}));return Inputmask.format(`${r*i}`,{alias:"prata"})}},{name:"ignorar",type:"checkbox",title:"Ignorar",width:120,itemTemplate:function(n,t){return t.IsTotal?"":$("<input>").prop("type","checkbox").attr("checked",n).attr("disabled",!0)}},{type:"control",deleteButton:!1,editButton:!1,itemTemplate:function(){return jsGrid.fields.control.prototype.itemTemplate.apply(this,arguments)}}],controller:{loadData:function(){BlockElement("#consultarForm");var n=$.Deferred();return $.post({url:"/Receita/SubReceitas",data:{receitaReferenciaId:$("#receitaSelect").val(),quantidade:parseInt($("#quantidade").inputmask("unmaskedvalue")),procNormal:$("#proc-normal").val(),procRaro:$("#proc-raro").val(),maestriaId:$("#maestriaSelect").val(),tipoReceita},dataType:"json"}).done(function(t){n.resolve(t);UnblockElement("#consultarForm")}),n.promise()}}});$("#resultadosGrid").jsGrid({width:"100%",inserting:!1,editing:!0,sorting:!1,paging:!1,autoload:!0,selecting:!1,pageLoading:!1,onItemUpdated:function(){$("#resultadosGrid").jsGrid("refresh")},onRefreshed:function(n){var r=n.grid.option("data"),t={Img:"",Item:"",Quantidade:0,Preco:0,Total:0,QuantidadePorCaixaImperial:0,CaixaImperial:"",QuantidadeImperial:0,ValorPorCaixa:0,PrecoPorCaixa:0,TotalImperial:0,IsTotal:!0},i;r.forEach(function(n){let i=0,r=0;i=typeof n.preco=="string"?parseInt(Inputmask.unmask(n.preco,{alias:"prata"})):n.preco;r=typeof n.quantidade=="string"?parseInt(Inputmask.unmask(n.quantidade,{alias:"prata"})):n.quantidade;n.ignorar===!1&&(t.QuantidadeImperial+=n.quantidadeImperial,t.Total+=r*i,t.TotalImperial+=n.quantidadeImperial*n.precoPorCaixa,t.PrecoPorCaixa=n.precoPorCaixa)});i=$("<tr>").addClass("total-row");n.grid._renderCells(i,t);n.grid._content.append(i)},fields:[{name:"img",align:"center",title:"",width:80,itemTemplate:function(n,t){return t.IsTotal?"Totais":t.img!==null&&t.img!==undefined&&t.img!==""?`<img src="${t.img}" style="max-width: 44px;"/>`:`<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsBAMAAADsqkcyAAAAFVBMVEXr6+sAAABYWFiSkpKwsLDNzc11dXVUvnWIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAOElEQVQokWNgGAUjAjABITINBcZAyMLgAKYRgCWYJRgkB6HhgNnN2Q2kFEIjiQMhyBAQPQoGPQAAoJ4FT0msjZwAAAAASUVORK5CYII=" style="max-width: 44px;"/>`}},{name:"item",title:"Produzido",type:"text",width:160,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":n}},{name:"quantidade",type:"prataField",title:"Qtd. Produzida",width:120,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})}},{name:"preco",type:"prataField",title:"Preço Mercado",width:120,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})}},{name:"total",type:"prataField",title:"Lucro Bruto",width:120,editing:!1,inserting:!1,itemTemplate:function(n,t){if(t.IsTotal)return Inputmask.format(`${t.Total}`,{alias:"prata"});let i=parseInt(Inputmask.unmask(`${t.preco}`,{alias:"prata"})),r=parseInt(Inputmask.unmask(`${t.quantidade}`,{alias:"prata"})),u=r*i;return Inputmask.format(`${u}`,{alias:"prata"})}},{name:"quantidadePorCaixaImperial",type:"text",title:"Caixa Imperial",visible:!1,width:120,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":n}},{name:"caixaImperial",type:"text",title:"Caixa Imperial",width:120,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":n}},{name:"quantidadeImperial",type:"prataField",title:"Qtd. Caixa Imperial",width:160,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?`${t.QuantidadeImperial} x ${Inputmask.format(`${t.PrecoPorCaixa}`,{alias:"prata"})} = ${Inputmask.format(`${t.TotalImperial}`,{alias:"prata"})}`:n}},{name:"precoPorCaixa",type:"prataField",title:"Valor/Caixa",width:120,editing:!1,inserting:!1,itemTemplate:function(n,t){return t.IsTotal?"":Inputmask.format(`${n}`,{alias:"prata"})}},{name:"totalImperial",type:"prataField",title:"Valor/Caixa",width:120,visible:!1,editing:!1,inserting:!1},{name:"ignorar",type:"checkbox",title:"Ignorar",width:120,itemTemplate:function(n,t){return t.IsTotal?"":$("<input>").prop("type","checkbox").attr("checked",n).attr("disabled",!0)}},{type:"control",deleteButton:!1,editButton:!1,itemTemplate:function(n,t){if(t.IsTotal)return"";return jsGrid.fields.control.prototype.itemTemplate.apply(this,arguments)}}],controller:{loadData:function(){BlockElement($("#resultados"));var n=$.Deferred();return $.post({url:"/Receita/Resultados",data:{tipoReceita:tipoReceita,receitaReferenciaId:$("#receitaSelect").val(),quantidade:parseInt($("#quantidade").inputmask("unmaskedvalue")),procNormal:$("#proc-normal").val(),procRaro:$("#proc-raro").val(),maestria:$("#maestriaSelect").val(),maestriaImperial:maestriaImperialSelecionada},dataType:"json"}).done(function(t){n.resolve(t);UnblockElement($("#resultados"))}),n.promise()}}});$("#dependenciaDiretaTb").jsGrid({width:"100%",inserting:!1,editing:!1,sorting:!1,paging:!1,autoload:!1,selecting:!1,pageLoading:!1,fields:[{name:"img",align:"center",title:"",width:80,itemTemplate:function(n,t){return t.img!==null&&t.img!==undefined&&t.img!==""?`<img src="${t.img}" style="max-width: 44px;"/>`:`<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsBAMAAADsqkcyAAAAFVBMVEXr6+sAAABYWFiSkpKwsLDNzc11dXVUvnWIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAOElEQVQokWNgGAUjAjABITINBcZAyMLgAKYRgCWYJRgkB6HhgNnN2Q2kFEIjiQMhyBAQPQoGPQAAoJ4FT0msjZwAAAAASUVORK5CYII=" style="max-width: 44px;"/>`}},{name:"nome",title:"USADO DIRETAMENTE EM",type:"text",width:120,editing:!1,inserting:!1},{name:"preco",type:"prataField",title:"PREÇO DO MERCADO",width:120,editing:!1,inserting:!1},],controller:{loadData:function(){var n=$.Deferred();return $.post({url:"/Item/DependenciasDiretas",data:{referenciaId:$("#receitaSelect").val()},dataType:"json"}).done(function(t){n.resolve(t)}),n.promise()}}});$("#dependenciaIndiretaTb").jsGrid({width:"100%",inserting:!1,editing:!1,sorting:!1,paging:!1,autoload:!1,selecting:!1,pageLoading:!1,fields:[{name:"img",align:"center",title:"",width:80,itemTemplate:function(n,t){return t.img!==null&&t.img!==undefined&&t.img!==""?`<img src="${t.img}" style="max-width: 44px;"/>`:`<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsBAMAAADsqkcyAAAAFVBMVEXr6+sAAABYWFiSkpKwsLDNzc11dXVUvnWIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAOElEQVQokWNgGAUjAjABITINBcZAyMLgAKYRgCWYJRgkB6HhgNnN2Q2kFEIjiQMhyBAQPQoGPQAAoJ4FT0msjZwAAAAASUVORK5CYII=" style="max-width: 44px;"/>`}},{name:"nome",title:"USADO INDIRETAMENTE EM",type:"text",width:120,editing:!1,inserting:!1},{name:"preco",type:"prataField",title:"PREÇO DO MERCADO",width:120,editing:!1,inserting:!1},],controller:{loadData:function(){var n=$.Deferred();return $.post({url:"/Item/DependenciasIndiretas",data:{referenciaId:$("#receitaSelect").val()},dataType:"json"}).done(function(t){n.resolve(t)}),n.promise()}}});$("#detalhesReceitaGrid").jsGrid({width:"100%",inserting:!1,editing:!1,sorting:!1,paging:!1,autoload:!1,selecting:!1,pageLoading:!1,fields:[{name:"img",align:"center",title:"",width:80,itemTemplate:function(n,t){return t.img!==null&&t.img!==undefined&&t.img!==""?`<img src="${t.img}" style="max-width: 44px;"/>`:`<img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACwAAAAsBAMAAADsqkcyAAAAFVBMVEXr6+sAAABYWFiSkpKwsLDNzc11dXVUvnWIAAAACXBIWXMAAA7EAAAOxAGVKw4bAAAAOElEQVQokWNgGAUjAjABITINBcZAyMLgAKYRgCWYJRgkB6HhgNnN2Q2kFEIjiQMhyBAQPQoGPQAAoJ4FT0msjZwAAAAASUVORK5CYII=" style="max-width: 44px;"/>`}},{name:"descricao",title:"Descrição",type:"text",width:120,editing:!1,inserting:!1},{name:"total",title:"Total",type:"text",width:120,editing:!1,inserting:!1},],controller:{loadData:function(){var n=$.Deferred();return $.post({url:"/Item/DependenciasIndiretas",data:{referenciaId:$("#receitaSelect").val()},dataType:"json"}).done(function(t){n.resolve(t)}),n.promise()}}})}function s(){$(".cbx").iCheck({checkboxClass:"icheckbox_square-red",radioClass:"iradio_square-red"})}n();o();f();u();e();r();i();s();t()});